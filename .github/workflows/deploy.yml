name: ğŸš€ Gigantischer GitHub Pages Autodeployer

on:
  push:
    branches:
      - main  # Hauptbranch fÃ¼r Deployment
      - gh-pages  # Falls GitHub Pages einen separaten Branch nutzt
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # Automatische tÃ¤gliche ÃœberprÃ¼fung & Deployment um Mitternacht

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Repository auschecken (immer neueste Version)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ” Sicherheits-Check vor dem Deployment
        run: |
          echo "âœ… ÃœberprÃ¼fung der Repository-Sicherheit..."
          if [[ -z "$(ls -A)" ]]; then echo "âš ï¸ Fehler: Repository ist leer!" && exit 1; fi
          echo "âœ… Sicherheits-Check bestanden!"

      - name: ğŸ› ï¸ Framework-Check & Build-Setup
        run: |
          echo "ğŸ” Erkenne Projektstruktur..."
          if [ -f "package.json" ]; then
            echo "ğŸš€ Node.js-Projekt erkannt (React, Vue, Svelte, Next.js)..."
            npm install && npm run build || echo "âš ï¸ Build-Fehler ignoriert"
            cp -r dist/* ./public || cp -r build/* ./public
          elif [ -f "_config.yml" ]; then
            echo "ğŸ“ Jekyll-Projekt erkannt..."
            bundle install && bundle exec jekyll build -d ./public
          else
            echo "ğŸ“„ Statische HTML-Seite erkannt, nutze direkten Deploy..."
            mkdir -p ./public && cp -r * ./public
          fi

      - name: ğŸ”’ Berechtigungen & Sicherheit erhÃ¶hen
        run: |
          chmod -R 755 ./public
          find ./public -type f -exec chmod 644 {} \;
          echo "âœ… Dateiberechtigungen gesetzt"

      - name: ğŸš€ Hochladen fÃ¼r GitHub Pages Deployment
        uses: actions/upload-pages-artifact@v2  # NEUE Version!

      - name: âœ… GitHub Pages verÃ¶ffentlichen
        uses: actions/deploy-pages@v2

      - name: ğŸ“¡ Erfolgsmeldung bei erfolgreichem Deployment
        if: success()
        run: echo "ğŸš€ Deployment erfolgreich! ğŸ‰"

      - name: âŒ Fehlerbenachrichtigung bei Problemen
        if: failure()
        run: echo "âŒ Fehler beim Deployment! Bitte Logs prÃ¼fen."
